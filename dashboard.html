<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3D Sheet Dashboard - Kasatria</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: Arial, sans-serif; }
        #menu { position: fixed; bottom: 20px; width: 100%; text-align: center; z-index: 10; }

        .element {
            width: 140px; height: 180px;
            box-shadow: 0px 0px 12px rgba(0,255,255,0.5);
            border: 1px solid rgba(127,255,255,0.25);
            text-align: center; cursor: default;
        }

        .net-worth { position: absolute; top: 10px; right: 10px; font-size: 10px; color: white; font-weight: bold; }
        .avatar { width: 70px; height: 70px; border-radius: 50%; margin-top: 25px; border: 2px solid white; background: #222; }
        .name { display: block; font-size: 14px; font-weight: bold; color: #fff; margin-top: 10px; }
        .details { font-size: 11px; color: rgba(255,255,255,0.8); margin-top: 5px; }

        button {
            color: cyan; background: transparent; border: 1px solid cyan;
            padding: 8px 18px; cursor: pointer; margin: 0 5px;
        }
        button:hover { background: rgba(0,255,255,0.2); }

        #loading {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; color: cyan; display: flex; align-items: center;
            justify-content: center; z-index: 100; font-size: 24px;
        }
    </style>
</head>
<body>

<div id="loading">FETCHING DATA...</div>
<div id="container"></div>

<div id="menu">
    <button id="table">TABLE</button>
    <button id="sphere">SPHERE</button>
    <button id="helix">HELIX</button>
    <button id="grid">GRID</button>
    <button id="pyramid">PYRAMID</button>
</div>

<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.158.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/"
  }
}
</script>

<script type="module">
import * as THREE from 'three';
import TWEEN from 'three/addons/libs/tween.module.js';
import { TrackballControls } from 'three/addons/controls/TrackballControls.js';
import { CSS3DRenderer, CSS3DObject } from 'three/addons/renderers/CSS3DRenderer.js';

const objects = [];
const targets = { table: [], sphere: [], helix: [], grid: [], pyramid: [] };

let camera, scene, renderer, controls;

let currentShape = 'table';

const SHEET_ID = '1t0DkbfA7yHp9YEA19ilfF1MasyRRHSO1YBhly7RJHDc';
const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

fetch(url)
  .then(res => res.text())
  .then(text => {
    const json = JSON.parse(text.substring(47).slice(0, -2));
    const rows = json.table.rows;

    const data = rows.map(r => ({
      name: r.c[0]?.v || "Unknown",
      photo: r.c[1]?.v || "",
      age: r.c[2]?.v || "??",
      country: r.c[3]?.v || "??",
      interest: r.c[4]?.v || "??",
      netWorthStr: r.c[5]?.f || r.c[5]?.v || "$0",
      netWorthVal: parseFloat((r.c[5]?.f || r.c[5]?.v || "0").replace(/[$,]/g, ''))
    }));

    document.getElementById('loading').style.display = 'none';
    init(data);
    animate();
  });

function init(data) {
  camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 10000);
  camera.position.z = 3000;
  scene = new THREE.Scene();

  data.forEach((item, i) => {
    const el = document.createElement('div');
    el.className = 'element';

    if (item.netWorthVal < 100000) el.style.background = 'rgba(239,48,34,0.7)';
    else if (item.netWorthVal > 200000) el.style.background = 'rgba(0,255,0,0.5)';
    else el.style.background = 'rgba(255,165,0,0.7)';

    el.innerHTML = `
      <div class="net-worth">${item.netWorthStr}</div>
      <img class="avatar" src="${item.photo}">
      <div class="name">${item.name}</div>
      <div class="details">${item.age} | ${item.country}<br>${item.interest}</div>
    `;

    const obj = new CSS3DObject(el);
    obj.position.set(Math.random()*4000-2000, Math.random()*4000-2000, Math.random()*4000-2000);
    scene.add(obj);
    objects.push(obj);

    const t = new THREE.Object3D();
    t.position.x = ((i % 20) * 160) - 1500;
    t.position.y = -(Math.floor(i / 20) * 200) + 800;
    targets.table.push(t);
  });

  const vector = new THREE.Vector3();


  objects.forEach((_, i) => {
    const phi = Math.acos(-1 + (2 * i) / objects.length);
    const theta = Math.sqrt(objects.length * Math.PI) * phi;
    const o = new THREE.Object3D();
    o.position.setFromSphericalCoords(800, phi, theta);
    vector.copy(o.position).multiplyScalar(2);
    o.lookAt(vector);
    targets.sphere.push(o);
  });


  objects.forEach((_, i) => {
    const o = new THREE.Object3D();
    const strand = (i % 2 === 0) ? 0 : Math.PI;
    const theta = i * 0.175 + strand;
    const y = -(i * 8) + 450;
    o.position.setFromCylindricalCoords(900, theta, y);
    vector.set(o.position.x * 2, o.position.y, o.position.z * 2);
    o.lookAt(vector);
    targets.helix.push(o);
  });

  objects.forEach((_, i) => {
    const o = new THREE.Object3D();
    o.position.x = ((i % 5) * 400) - 800;
    o.position.y = (-(Math.floor(i / 5) % 4) * 400) + 600;
    o.position.z = (Math.floor(i / 20)) * -800 + 500;
    targets.grid.push(o);
  });

const size = 900;

const V = [
  new THREE.Vector3( 1,  1,  1),
  new THREE.Vector3(-1, -1,  1),
  new THREE.Vector3(-1,  1, -1),
  new THREE.Vector3( 1, -1, -1)
].map(v => v.multiplyScalar(size));

const faces = [
  [0, 1, 2],
  [0, 3, 1],
  [0, 2, 3],
  [1, 3, 2]
];

objects.forEach((_, i) => {
  const f = faces[i % 4];

  const A = V[f[0]];
  const B = V[f[1]];
  const C = V[f[2]];

  let u = Math.random();
  let v = Math.random();
  if (u + v > 1) {
    u = 1 - u;
    v = 1 - v;
  }

  const point = new THREE.Vector3()
    .copy(A)
    .addScaledVector(B.clone().sub(A), u)
    .addScaledVector(C.clone().sub(A), v);

  const normal = new THREE.Vector3()
    .subVectors(B, A)
    .cross(new THREE.Vector3().subVectors(C, A))
    .normalize();

  point.addScaledVector(normal, 80);

  const o = new THREE.Object3D();
  o.position.copy(point);
  o.lookAt(0, 0, 0);

  targets.pyramid.push(o);
});



  renderer = new CSS3DRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.getElementById('container').appendChild(renderer.domElement);

  controls = new TrackballControls(camera, renderer.domElement);

  document.getElementById('table').onclick = () => {
  currentShape = 'table';
  transform(targets.table, 2000);
};

document.getElementById('sphere').onclick = () => {
  currentShape = 'sphere';
  transform(targets.sphere, 2000);
};

document.getElementById('helix').onclick = () => {
  currentShape = 'helix';
  transform(targets.helix, 2000);
};

document.getElementById('grid').onclick = () => {
  currentShape = 'grid';
  transform(targets.grid, 2000);
};

document.getElementById('pyramid').onclick = () => {
  currentShape = 'pyramid';
  transform(targets.pyramid, 2000);
};


  transform(targets.table, 2000);
  window.addEventListener('resize', onWindowResize);
}

function transform(target, duration) {
  TWEEN.removeAll();
  objects.forEach((obj, i) => {
    new TWEEN.Tween(obj.position).to(target[i].position, duration).easing(TWEEN.Easing.Exponential.InOut).start();
    new TWEEN.Tween(obj.rotation).to(target[i].rotation, duration).easing(TWEEN.Easing.Exponential.InOut).start();
  });
}

function onWindowResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
    requestAnimationFrame(animate);

    if (currentShape === 'pyramid') {
        scene.rotation.y += 0.002;
    }

    TWEEN.update();
    controls.update();
    renderer.render(scene, camera);
}

</script>
</body>
</html>
